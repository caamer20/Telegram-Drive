# Telegram Drive v0.2.0 Implementation Plan

## 1. Cleanup: Remove Legacy Drag-and-Drop
- [ ] **Remove Event Listeners**: Remove `tauri://file-drop-hover`, `tauri://file-drop-cancelled` listeners in `Dashboard.tsx`.
- [ ] **Remove UI Components**: Remove the `isDragging` state and the "Drop files to upload" overlay in `Dashboard.tsx`.
- [ ] **Cleanup**: Remove `onDragOver` and `onDrop` handlers related to external file drops if implied, but keep the `onDrop` for *internal* moves if we decided to keep that? 
  - *Correction*: ensuring "Move to..." modal replaced the internal drag-and-drop. The user said "Remove Legacy Drag-and-Drop... associated with non-functional windows". This likely refers to the external file drop overlay which might have been buggy or unwanted.
  - I will remove the External File Drop Overlay.

## 2. Upload Queue System
- [ ] **Frontend State**: Create an `UploadQueue` context or state in `Dashboard.tsx`.
- [ ] **Data Structure**: `QueueItem { id, file, status: 'pending'|'uploading'|'completed'|'error', progress }`.
- [ ] **Logic**: Modify `handleManualUpload` to add files to queue instead of blocking await.
- [ ] **Processor**: A `useEffect` that catches `pending` items and processes them sequentially or in limited parallel.
- [ ] **UI**: Add a floating "Upload Progress" widget in the bottom right.

## 3. Bandwidth Management
- [ ] **Backend Service**: Create `src-tauri/src/bandwidth.rs`.
- [ ] **Storage**: simple JSON persistence `bandwidth.json` to store `{ "date": "YYYY-MM-DD", "bytes_used": 12345 }`.
- [ ] **Integration**: Update `upload_file` and `download_file` commands in `commands.rs` to:
    1. Check usage limit (gatekeeper).
    2. Update usage after transfer.
- [ ] **Reset Logic**: Check date on every request. If new day, reset to 0.
- [ ] **Frontend**: Show daily usage in the UI (maybe in the Sidebar bottom).

## 4. Image Enhancements
- [ ] **Backend**: Use `image` crate to generate thumbnails for image files before upload.
    - *Challenge*: Telegram has its own way of handling photos. Can we upload as `InputFile` with thumb? Or just upload as Document and let Telegram generate? Telegram usually generates thumbs for 'photos' (compressed) but maybe not 'documents' (uncompressed) automatically unless specified.
    - *Approach*: Start by trying to extract the thumbnail from `grammers` message if available.
- [ ] **Thumbnail Extraction**: Update `FileMetadata` to include `thumbnail_data` (base64) or logic to fetch it.
    - Fetching thumbnails for every file in a list might be slow.
    - *Alternative*: Use a "Quick View" modal that fetches the full image (or a preview size) on demand.
- [ ] **UI**: 
    - Replace generic icons with thumbnails where available.
    - Add "Eye" icon for Preview Modal.
    - Create `PreviewModal` component.

## Execution Order
1. Cleanup
2. Bandwidth Management (Backend)
3. Upload Queue (Frontend)
4. Image Enhancements

